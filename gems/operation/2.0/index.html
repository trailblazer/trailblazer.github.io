<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Trailblazer: Operation Overview</title>
<meta name="description" content="Operation Overview - Trailblazer">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content=", ">

<!-- style -->
<link rel="shortcut icon" href="/favicon.ico">
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,%20400,700,800%7CRaleway:400,200,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="/css/application.css">

<!-- script -->
<script src="/javascripts/jquery.min.js"></script>
<script src="/javascripts/application.min.js"></script>
<script>
  jQuery(document).ready(function($) {
    $(document).foundation();

    anchors.add("article h2");
    anchors.add("article h3");

    hljs.configure({
      languages: ['ruby', 'haml']
    });

    hljs.initHighlightingOnLoad();

    // $('#code-slider').slick({arrows: true, dots: true});
    $('.carousel').slick({arrows: true, dots: true});
  });
</script>


<meta property="og:title" content="Operation Overview">
<meta property="og:site_name" content="Trailblazer">
<meta property="og:url" content="http://trailblazer.to/gems/operation/2.0/">
<meta property="og:description" content="An overview about the Operation in Trailblazer: an object that embraces and orchestrates all business logic for one function.">
<meta property="og:image" content="http://trailblazer.to/images/go-trailblazer.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@apotonick">
<meta name="twitter:title" content="Operation Overview">
<meta name="twitter:description" content="An overview about the Operation in Trailblazer: an object that embraces and orchestrates all business logic for one function.">
<meta name="twitter:image" content="http://trailblazer.to/images/diagrams/operation-2017-small.png">

  </head>
  <body>

    <div data-sticky-container class="top-navbar">
  <div class="top-bar sticky" data-sticky data-options="marginTop:0;" style="width:100%">
    <div class="top-bar-title">
      <ul class="menu horizontal">
        <li>
          <a href="/"><img style="height: 25px;" src="/images/logo-top.svg"></a>
        </li>
        <li>
        <span data-responsive-toggle="responsive-menu" data-hide-for="medium">
          <button class="menu-icon" type="button" data-toggle></button>
        </span>
        </li>
      </ul>
    </div>

    <div id="responsive-menu">
      <div class="top-bar-right">
        <ul class="dropdown menu     vertical medium-horizontal" data-dropdown-menu>
          <li><a href="/gems/operation/2.0/release_notes.html">TRB 2.O IS COMING!</a></li>
          <li><a href="https://trbpro.herokuapp.com/">PREMIUM SUPPORT <img alt="Premium Support" src="/images/pro-white.png"></a></li>
          <li><a href="/newsletter/">NEWSLETTER</a></li>
          <li><a href="https://gitter.im/trailblazer/chat" onclick="trackOutboundLink('https://gitter.im/trailblazer/chat'); return false;">CHAT</a></li>
          <li><a href="/guides">GUIDES</a></li>
          <li>
            <a href="#">GEMS</a>
            <ul class="menu vertical">
              <li class=""><a href="/gems/cells">CELLS</a></li>
              <li class=""><a href="/gems/operation/2.0/index.html">OPERATION</a></li>
              <li class=""><a href="/gems/reform">REFORM</a></li>
              <li class=""><a href="/gems/representable">REPRESENTABLE</a></li>
              <li class=""><a href="/gems/roar">ROAR</a></li>
              <li class=""><a href="/gems/disposable">DISPOSABLE</a></li>
            </ul>
          </li>
          <li>
            <a href="https://leanpub.com/trailblazer" class="button secondary" onclick="trackOutboundLink('https://leanpub.com/trailblazer'); return false;">GET THE BOOK</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>


    <!-- Hero -->
<div class="hero gems-hero operation2-hero">
  <div class="hero-unit">
    <div class="expanded row">
      <div class="columns">
        <h1 id="project_title">
          Operation
        </h1>
      </div>
    </div>
  </div>
</div>


    <div class="expanded row">
      <div class="medium-9 large-10 medium-push-3 large-push-2 columns">
        <article class="operation2-body">

          
            <header id="doc-header">
  <h1 class="doc-page-title">Operation Overview</h1>
  <span class="doc-last-updated"><i class="fa fa-clock-o" aria-hidden="true"></i> Last updated 22 January 2017</span>

  
    <span class="doc-last-updated">
      <i class="fa fa-diamond" aria-hidden="true"></i>
      <a href="https://github.com/trailblazer/trailblazer-operation">operation</a>

      <a href="/gems/operation/2.0/index.html">
      <span class="version">v2.0</span>
      </a>

    
      <a href="/gems/operation/1.1/index.html">
        <span class="version other">v1.1</span>
      </a>
    

    </span>
  

  <hr>

</header>

          

          <div class="row"> <!-- nach doc header -->
            <div class="large-9 columns" id="docs">   <!-- actual docs -->
              <p><img src="/images/diagrams/operation-2017-small.png" class="diagram left"></p>

<p>An operation is a service object.</p>

<p>Its goal is simple: <strong>Remove all business logic from the controller and model and provide a separate, streamlined object for it.</strong></p>

<p>Operations implement functions of your application, like creating a comment, following a user or exporting a PDF document. Sometimes this is also called <em>command</em>.</p>

<p>Technically, an operation embraces and orchestrates all business logic between the controller dispatch and the persistence layer. This ranges from tasks as finding or creating a model, validating incoming data using a form object to persisting application state using model(s) and dispatching post-processing callbacks or even nested operations.</p>

<p>Note that operation is not a monolithic god object, but a composition of many stakeholders. It is up to you to orchestrate features like policies, validations or callbacks.</p>

<h2 id="what-it-looks-like" data-magellan-target="what-it-looks-like">What It Looks Like</h2>

<section class="macros">
  <div class="row">
    <div class="column medium-6">
    <p>
      Operations are usually invoked straight from the controller action. They orchestrate all domain logic necessary to perform the app's function.
    </p>
<pre>
<code>
result = Song::Create.({ title: "SVT" })
</code>
</pre>

    <p>
      There is only one way to run an operation: using <code>Operation.call</code>. This can also be written as <code>Operation.()</code>.
    </p>

    <p>
    The absence of a method name here is per design: this object does only one thing, and hence <strong>what it does is reflected in the class name</strong>.
    </p>

<pre>
<code>
result = Song::Create.(
  params,
  "current_user" =&gt; Warden.get_user
)
</code>
</pre>

    <p>
    You have to pass all runtime data to the operation in this call. <code>params</code>, current user, you name it.
    </p>

    </div>

    <div class="column medium-6">
    <p>
    The implementation is a class.
    </p>

<pre><code>class Song::Create &lt; Trailblazer::Operation
  extend Contract::DSL

  contract do
    property :title
    validates :title, presence: true
  end

  step     Model( Song, :new )
  step     :assign_current_user!
  step     Contract::Build()
  step     Contract::Validate( )
  failure  :log_error!
  step     Contract::Persist(  )

  def log_error!(options)
    # ..
  end

  def assign_current_user!(options)
    options["model"].created_by =
      options["current_user"]
  end
end
</code></pre>

    </div>
  </div>

</section>

<p>The operations control flow is handled by a two-tracked pipe. It helps you dealing with errors without littering your code with <code class="highlighter-rouge">if</code>s and <code class="highlighter-rouge">rescue</code>s. You can add your own, custom steps to that workflow and use Trailblazer’s built-in macros.</p>

<h2 id="flow-control" data-magellan-target="flow-control">Flow Control</h2>

<section class="macros">
  <div class="row">
    <div class="column medium-3">
      <img src="/images/diagrams/overview-flow-animated.gif">
    </div>

    <div class="column medium-4">
      <p>
        An operation has a two-tracked flow called a <em>pipe</em>. On the right track you add <em>steps</em> for the happy path, assuming no errors happen using <code>step</code>. They will executed in the order you add them.
      </p>

      <p>
        On the left track, you add error handler steps using <code>failure</code>. They work exactly like the right track, but won't be executed until you deviate from the right track.
      </p>
    </div>

    <div class="column medium-5">
<pre>
<code>
  step     Model( Song, :new )
  step     :assign_current_user!
  step     Contract::Build()
  step     Contract::Validate( )
  failure  :log_error!
  step     Contract::Persist(  )
</code>
</pre>
      <p>
        Steps will deviate to the left track if their return value is falsey.

      </p>
    </div>

  </div>
</section>

<h2 id="macros" data-magellan-target="macros">Macros</h2>

<p>Trailblazer comes with a set of helpful pipe macros that give you predefined step logic to implement the most common tasks.</p>

<section class=" ">
  <div class="row">
    <div class="column medium-4 ">
        <p><i class="engage fa fa-cogs"></i></p>

<p><code class="name"><a href="api.html#nested">Nested</a></code>, <code class="name"><a href="api.html#wrap">Wrap</a></code> and <code class="name"><a href="api.html#rescue">Rescue</a></code> help to nest operations, or wrap parts of the pipe into a <code>rescue</code> statement, a transaction, etc.</p>


      </div>
    <div class="column medium-4 ">
        <p><i class="engage fa fa-search"></i></p>

<p><code class="name">Contract::Build</code>, <code class="name">Validate</code> and <code class="name">Persist</code> help dealing with Dry schemas or Reform contracts to validate input, and push sane data to models.</p>

      </div>
    <div class="column medium-4 ">
        <p><i class="engage fa fa-shield"></i></p>

<p><code class="name"><a href="policy.html#guard">Guard</a></code> and <code class="name"><a href="policy.html#pundit">Policy::Pundit</a></code> are ideal steps to protect operations (or parts of it) from being run unauthorized.</p>

      </div>
</div></section>

<p>Macros are easily extendable and it’s you can write your own application-wide macros.</p>

<h2 id="state-and-result" data-magellan-target="state-and-result">State and Result</h2>

<section class=" ">
  <div class="row">
    <div class="column medium-8 ">
        <p>Each step in the operation can write to the <em>options</em> object that is passed from step to step, and in the end will be the result of the operation call.</p>

<pre><code>class Song::Update &lt; Trailblazer::Operation
  step :find_model!
  step :assign_current_user!

  def find_model!(options, params:, **)
    options["model"] = Song.find_by(id: params[:id])
  end

  def assign_current_user!(options, current_user:, **)
    options["model"].created_by = current_user
  end
end
</code></pre>


      </div>
    <div class="column medium-4 ">
        
<p>Maintaining one stateful object, only, allows using callable objects and lambdas as steps as well.</p>

<pre><code>class Song::Update &lt; Trailblazer::Operation
  step MyCallable
  step -&gt;(options, params:, **) { ... }
</code></pre>

<p>After running, this object is the result.</p>

<pre><code>result = Song::Update.(id: 1, ..)

result.success? #=&gt; true
result["model"] #=&gt; #&lt;Song ..&gt;
</code></pre>


      </div>
</div></section>

<h2 id="testing" data-magellan-target="testing">Testing</h2>

<section class=" ">
  <div class="row">
    <div class="column medium-6 ">
        <p>Since operations embrace the entire workflow for an application’s function, you can write simple and fast unit-tests to assert the correct behavior.</p>

<pre><code>describe Song::Create do
  it "prohibits empty params" do
    result = Song::Create.({})

    expect(result).to be_failure
    expect(result["model"]).to be_new
  end
end
</code></pre>

<p>All edge-cases and bugs can be tested via unit tests. Slow, inefficient integration tests are reduced to a minimum.</p>

      </div>
    <div class="column medium-6 ">
        <p>Operations can also replace factories.</p>

<pre><code>describe Song::Create do
  let(:song) { Song::Create.(params) }
</code></pre>

<p>This will make sure your application test state is always inline with what happens in production. You won’t have an always diverging <em>factory vs. production state</em> ever again.</p>

<p>Check out <a href="https://github.com/trailblazer/rspec-trailblazer">our Rspec gem</a> for TRB matcher integration. Matchers for Minitest are coming, too!</p>

      </div>
</div></section>

<h2 id="learn-more" data-magellan-target="learn-more">Learn More</h2>

<p>A mix of documentation and guides will help you to understand the operation quickly and how to use it to clean up existing codebases or start a new app.</p>

<section class=" ">
  <div class="row">
    <div class="column medium-4 ">
        <p><i class="engage fa fa-map"></i></p>

<p>Read the <a href="api.html"><strong>→API DOCS</strong></a> to learn about the pipe and step implementations and what macros Trailblazer provides for you.</p>

      </div>
    <div class="column medium-4 ">
        <p><i class="engage fa fa-book"></i></p>

<p>Make sure to spend some hours reading the <a href="/guides/trailblazer/2.0/01-operation-basics.html"><strong>→GETTING STARTED</strong></a> guide.</p>

<p>You will be ready to work with Trailblazer 2.</p>

      </div>
    <div class="column medium-4 ">
        <p><i class="engage fa fa-comments-o"></i></p>

<p>Jump on our public <a href="https://gitter.im/trailblazer/chat"><strong>→SUPPORT CHAT</strong></a>.</p>

<p>It doesn’t matter whether you have specific questions or just want to chat about software architecture, whisky or TDD - we’ll be there!</p>

      </div>
</div></section>

<section class=" ">
  <div class="row">
    <div class="column medium-12 text-center">
        <p><a href="/guides/trailblazer/2.0/01-operation-basics" class="button">GET STARTED!</a></p>

      </div>
</div></section>

            </div>

            <div class="large-3 columns sticky-container" data-sticky-container>

              
                <nav class="sticky columns docs-toc-wrap sticky is-anchored is-at-top side-nav" data-sticky data-anchor="docs" data-sticky-on="large" data-margin-top="5">
  
        <ul class="vertical menu" data-magellan id="page-toc">
          <li class="page-toc-heading">ON THIS PAGE:</li>
          <li><a href="#what-it-looks-like">What It Looks Like</a></li>
<li><a href="#flow-control">Flow Control</a></li>
<li><a href="#macros">Macros</a></li>
<li><a href="#state-and-result">State and Result</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#learn-more">Learn More</a></li>
        </ul>
      
</nav>

              

            </div>
          </div>
        </article>
      </div>

      <div class="medium-3 large-2 medium-pull-9 large-pull-10 columns">
        <ul class="vertical menu side-nav">
    <li class="heading">
        <a href="/gems/operation/2.0/index.html">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> OPERATION
        </a>
    </li>
    <li><a href="/gems/operation/2.0/api.html">API</a></li>
    <li><a href="/gems/operation/2.0/contract.html">Contract</a></li>
    <!-- <li><a href="/gems/operation/2.0/representer.html">Representer</a></li> -->
    <li><a href="/gems/operation/2.0/policy.html">Policy</a></li>
    <li><a href="/gems/operation/2.0/representer.html">Representer</a></li>
<!--     <li><a href="/gems/operation/2.0/pipetree.html">Pipetree</a></li>
 -->
    <li><a href="/gems/operation/2.0/endpoint.html">Endpoint</a></li>
    <li>
<a href="/gems/operation/1.1/index.html">
          <span class="sidebar-info">→ v1.1</span>
        </a>
    </li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/trailblazer/index.html">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> TRAILBLAZER
        </a>
    </li>
    <li><a href="/gems/trailblazer/2.0/rails.html">Rails</a></li>
    <li><a href="/gems/trailblazer/loader.html">Loader</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/cells">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> CELLS
        </a>
    </li>
    <li><a href="/gems/cells/getting-started.html">Getting Started<span class="sidebar-info">NEW</span></a></li>
    <li><a href="/gems/cells/api.html">API</a></li>
    <li><a href="/gems/cells/trailblazer.html">Trailblazer::Cell</a></li>
    <li><a href="/gems/cells/testing.html">Testing</a></li>
    <li><a href="/gems/cells/render.html">Rendering</a></li>
    <li><a href="/gems/cells/rails.html">Rails</a></li>
    <li><a href="/gems/cells/templates.html">Templates</a></li>
    <li><a href="/gems/cells/troubleshooting.html">Troubleshooting</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/reform">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> REFORM
        </a>
    </li>
    <li><a href="/gems/reform/api.html">API</a></li>
    <li><a href="/gems/reform/options.html">Options</a></li>
    <li><a href="/gems/reform/data-types.html">Data Types</a></li>
    <li><a href="/gems/reform/populator.html">Populator</a></li>
    <li><a href="/gems/reform/prepopulator.html">Prepopulator</a></li>
    <li><a href="/gems/reform/validation.html">Validation</a></li>
    <li><a href="/gems/reform/rails.html">Rails</a></li>
    <li><a href="/gems/reform/debugging.html">Debugging</a></li>
    <li><a href="/gems/reform/upgrading-guide.html">Upgrading Guide</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/representable">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> REPRESENTABLE
        </a>
    </li>
    <li><a href="/gems/representable/getting-started.html">Getting Started</a></li>
    <li><a href="/gems/representable/3.0/api.html">API</a></li>
    <li><a href="/gems/representable/3.0/function-api.html">Function API</a></li>
    <li><a href="/gems/representable/3.0/populator.html">Populator</a></li>
    <!-- <li><a href="/gems/representable/architecture.html">Architecture</a></li> -->
    <li><a href="/gems/representable/3.0/xml.html">XML</a></li>
    <li><a href="/gems/representable/3.0/yaml.html">YAML</a></li>
    <li><a href="/gems/representable/upgrading-guide.html">Upgrading Guide</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/roar">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> ROAR
        </a>
    </li>
    <li><a href="/gems/roar/jsonapi.html">JSON API</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/disposable">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> DISPOSABLE
        </a>
    </li>
    <li><a href="/gems/disposable/api.html">API</a></li>
    <li><a href="/gems/disposable/default.html">Default</a></li>
    <li><a href="/gems/disposable/callback.html">Callback</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/guides">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> GUIDES
        </a>
    </li>
    <li><a href="/guides/trailblazer/2.0/01-getting-started-with-operation.html">01- Getting Started with Operation</a></li>
    <li><a href="/guides/getting-started.html">Getting Started</a></li>
    <li><a href="/guides/sinatra/getting-started.html">Sinatra</a></li>
    <li><a href="/guides/grape.html">Grape</a></li>
</ul>

      </div>
    </div>


    <section class="top-footer">
  <div class="row">
    <div class="columns medium-6">
      <h3>Newsletter</h3>
      <p>
        Stay on top of what’s happening in Trailblazer.
      </p>
        <div class="row">
          <div id="mc_embed_signup">
            <form action="//trailblazerb.us8.list-manage.com/subscribe/post?u=bbe5021ab6fbdc94a16f0d036&amp;id=a69f6e4652" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

              <div class="columns large-9 medium-12 ">
                <div class="row collapse prefix-radius">
                  <div class="small-8 medium-7 large-8 columns">
                    <div id="mc_embed_signup_scroll">
                      <div class="mc-field-group">
                        <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="youremail@trailblazer.to">
                      </div>
                      <div id="mce-responses" class="clear">
                        <div class="response" id="mce-error-response" style="display:none"></div>
                        <div class="response" id="mce-success-response" style="display:none"></div>
                      </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_bbe5021ab6fbdc94a16f0d036_a69f6e4652" tabindex="-1" value=""></div>

                    </div>
                  </div>
                  <div class="small-4 medium-5 large-4 columns">
                    <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button postfix secondary">
                  </div>
                </div>
              </div>
            </form>
          </div>
          <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
        </div>
      <p>
        And check out the <a href="/newsletter/">archive of newsletters</a>!
      </p>


    </div>
    <div class="columns medium-6">
      <h3>The Book</h3>
      <p>Learn how to build a Rails app with Trailblazer, step-by-step.</p>
      <a href="https://leanpub.com/trailblazer" class="button secondary">Get the book!</a>
    </div>
  </div>
</section>

<footer>
  <div class="row">
    <div class="columns medium-4">
      <div class="logo-box">
        <a href="/"><img src="/images/icon_trb.png">
        </a>
      </div>
    </div>
    <div class="columns medium-8">
      <div class="row">
        <div class="columns medium-6">
          <h4>
            Trailblazer
          </h4>
          <ul class="no-bullet">
            <li><a href="https://gitter.im/trailblazer/chat">Gitter chat</a></li>
            <li><a href="https://leanpub.com/trailblazer" onclick="trackOutboundLink('https://leanpub.com/trailblazer'); return false;">The book</a></li>
          </ul>
        </div>
        <div class="columns medium-6">
          <h4>
            Follow Us
          </h4>
          <ul class="menu">
            <li>
              <a href="https://github.com/trailblazer">
                <i class="footer-icon github-icon"></i>
              </a>
            </li>
            <li>
              <a href="https://twitter.com/apotonick">
                <i class="footer-icon twitter-icon"></i>
              </a>
            </li>
            <li>
              <a href="https://facebook.com/trbinc">
                <i class="footer-icon facebook-icon"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <p class="copyright">
        Trailblazer is created by <a href="http://www.synergysoft.com.sg/">Synergy Software Solutions Pte Ltd,</a> and awesome friends.
      </p>
      <p class="copyright">
        Site designed and handcoded with love by <a href="https://twitter.com/noeliacabane">Noelia Cabane</a>
      </p>
    </div>
  </div>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69514939-1', 'auto');
  ga('send', 'pageview');

  /**
  * Function that tracks a click on an outbound link in Analytics.
  * This function takes a valid URL string as an argument, and uses that URL string
  * as the event label. Setting the transport method to 'beacon' lets the hit be sent
  * using 'navigator.sendBeacon' in browser that support it.
  */
  var trackOutboundLink = function(url) {
     ga('send', 'event', 'outbound', 'click', url, {
       'transport': 'beacon',
       'hitCallback': function(){document.location = url;}
     });
  }
</script>



  </body>
</html>
